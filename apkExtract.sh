#!/bin/bash
HELP_MSG="[+] Execute ./extractApk.sh (full_package_name)\n\n[*] Example: ./extractApk.sh org.telegram.messenger"
if [[ $# -eq 0 ]]; then
  echo "[-] No package name provided"
  echo -e "$HELP_MSG"
  exit 1
elif [[ $# -gt 1 ]]; then
  echo "[-] Too many arguments"
  echo -e "$HELP_MSG"
  exit 1
elif [[ $1 =~ ^[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)*$ ]]; then
  # if you have some problem just remove '--user 0' or change its value.
  package_name=$(adb shell "pm list packages --user 0 | grep $1 | cut -d ':' -f2")
  package_path=$(adb shell "pm path $package_name | cut -d ':' -f2")
  
  function extractApk ()
  {
    for full_path in $package_path
    do
      adb pull $full_path
    done
  }
  
  extractApk

else
  echo "[-] Bad string provided"
  echo -e "$HELP_MSG"
  exit 1
fi
